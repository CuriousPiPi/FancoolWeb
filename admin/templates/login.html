<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>后台登录</title>
  <style>
    :root { --ctl-h: 40px; --ctl-px: 10px; --ctl-fs: 16px; }
    body { font-family: system-ui; padding: 24px; }
    .card { max-width: 420px; margin: 12vh auto; border: 1px solid #ddd; border-radius: 12px; padding: 24px; }
    input, button {
      width: 100%; height: var(--ctl-h); padding: 0 var(--ctl-px); font-size: var(--ctl-fs);
      box-sizing: border-box;
    }
    input { margin: 8px 0; }
    button { margin-top: 12px; }
    .ok { color: #2e7d32; } .err { color: #c62828; }
  </style>
</head>
<body>
  <div class="card">
    <h2>后台登录</h2>
    <form id="f">
      <input name="login" placeholder="用户名" autocomplete="username" required />
      <input type="password" name="password" placeholder="密码" autocomplete="current-password" required />
      <button type="submit">登录</button>
    </form>
    <p id="msg"></p>
  </div>
  <script>
    const $ = s => document.querySelector(s);
    $('#f').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const r = await fetch('/admin/api/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({login: fd.get('login'), password: fd.get('password')})
      });
      const j = await r.json();
      if (j.success) {
        // 登录成功后自动跳转 /admin/data
        const to = j?.data?.redirect_to || '/admin/data';
        window.location.replace(to);
      } else {
        $('#msg').className = 'err';
        $('#msg').textContent = j.error_message || '登录失败';
      }
    });
  </script>
</body>
</html>