/* =========================================================
   Right Card (右侧主容器) 专用样式
   依赖：先加载 fancool.css，再加载本文件
   作用域：仅限 .fc-right-card 及其子元素
   ========================================================= */

/* 1) 右侧主容器定高 */
.fc-right-card {
  display: flex;
  flex-direction: column;
  height: clamp(480px, 62vh, 600px);
  min-height: 0;
  min-width: 0;
}

@media (max-width: 600px) {
  .fc-right-card {height: clamp(500px, 80vh, 650px);}
}

/* 2) 右侧页签排布 */
.fc-right-card > nav.fc-tabs { margin-bottom: 6px; }

.fc-tabs[data-tab-group="right-panel"] {
  flex-wrap: wrap;
}
.fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group {
  display: flex;
  flex-wrap: nowrap;
  gap: .5rem;
  flex: 1 1 auto;
  min-width: 0;
}
.fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group .fc-tabs__item {
  flex: 0 0 auto !important;
}

/* 窄容器（rp-narrow）布局 */
.fc-right-card.rp-narrow > nav.fc-tabs {
  flex-wrap: wrap;
  row-gap: 8px;
  column-gap: 10px;
  align-items: flex-start;
}
.fc-right-card.rp-narrow > nav.fc-tabs .flex-1 { display: none; }
.fc-right-card.rp-narrow > nav.fc-tabs .fc-tabs__item {
  flex: 1 1 calc(50% - 10px);
  text-align: center;
  padding: .55rem .8rem;
}
.fc-right-card.rp-narrow .fc-tabs__subseg {
  order:3;
  flex:1 1 100%;
  width:100%;
  display:flex;
  justify-content:center;
  margin-top:2px;
}
.fc-right-card.rp-narrow .fc-rank-box { padding-top:0; }
.fc-right-card.rp-narrow > nav.fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group {
  flex: 1 1 100%;
  width: 100%;
  justify-content: space-between;
}
.fc-right-card.rp-narrow > nav.fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group .fc-tabs__item {
  flex: 1 1 0 !important;
  text-align: center;
}

/* 屏幕宽度 ≤600px 时的布局 */
@media (max-width: 600px) {
  .fc-right-card > nav.fc-tabs { margin-bottom: 4px; }
  .fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group {
    flex: 1 1 100%;
    width: 100%;
    justify-content: space-between;
  }
  .fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group .fc-tabs__item {
    flex: 1 1 0 !important;
    text-align: center;
  }
}

/* 3) 内容区 Flex 高度链 */
.fc-right-card .fc-tab-container {
  flex: 1 1 auto;
  min-height: 0;
}
.fc-right-card .fc-tab-wrapper,
.fc-right-card .fc-tab-pane {
  height: 100%;
}
.fc-right-card .fc-tab-pane {
  display: flex;
  flex-direction: column;
}
.fc-right-card .fc-rank-box {
  flex: 1 1 auto;
  min-height: 0;
  padding-top: 0;
  display: flex;
  flex-direction: column;
}
.fc-right-card .fc-rank-panel.active {
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 0;
}

/* 4) 滚动层：仅右侧预留，避免显隐时错觉性右移 */
.fc-right-card .fc-rank-scroll {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  max-height: none !important;
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable; /* 仅右侧预留 */
}
@supports not (scrollbar-gutter: stable) {
  .fc-right-card .fc-rank-scroll { padding-right: var(--sbw); }
}

.fc-right-card .fc-rank-scroll::-webkit-scrollbar { width: 8px; }
.fc-right-card .fc-rank-scroll::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 4px;
}
.fc-right-card .fc-rank-scroll::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}

/* 5) 表头/操作列与遮罩 */
.fc-right-card .fc-rank-table thead th {
  position: sticky;
  top: 0;
  z-index: 8;
  background: var(--bg-secondary);
  box-shadow: 0 2px 3px -1px rgba(0,0,0,.08);
}
[data-theme="dark"] .fc-right-card .fc-rank-table thead th {
  box-shadow: 0 2px 3px -1px rgba(0,0,0,.45);
  backdrop-filter:saturate(120%) blur(8px);
}

.fc-right-card .fc-rank-table thead th:last-child {
  top: 0;
  z-index: 11;
  box-shadow: 0 2px 3px -1px rgba(0,0,0,.45);
}
.fc-right-card .fc-rank-table th:last-child,
.fc-right-card .fc-rank-table td:last-child {
  text-align: center;
  width: 60px;
  position: sticky;
  right: 0;
  background: var(--bg-secondary);
}
.fc-right-card .fc-rank-table td:last-child {
  padding: 8px;
  background: linear-gradient(to left, transparent 30px, rgba(0,0,0,0) 50px);
}

.fc-right-card .fc-rank-box { position: relative; }
.fc-right-card .fc-rank-box::after {
  content: "";
  position: absolute;
  top: 0; right: -2px; bottom: 0;
  width: calc(var(--sbw) + 3px);
  background: transparent;
  pointer-events: none;
  z-index: 20;
}

/* 响应式 ≤600px */
@media (max-width:600px) {
  .fc-tabs {
    flex-wrap:wrap;
    row-gap:8px;
    column-gap:10px;
    align-items:flex-start;
  }
  .fc-tabs .flex-1 { display:none; }
  .fc-tabs .fc-tabs__item {
    flex:1 1 calc(50% - 10px);
    text-align:center;
    padding:.55rem .8rem;
  }
  .fc-tabs__subseg {
    order:3;
    flex:1 1 100%;
    width:100%;
    display:flex;
    justify-content:center;
    margin-top:2px;
  }
  .fc-right-card > nav.fc-tabs { margin-bottom:4px; }
  .fc-right-card .fc-rank-box { padding-top:0; }

  .fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group {
    flex: 1 1 100%;
    width: 100%;
    justify-content: space-between;
  }
  .fc-tabs[data-tab-group="right-panel"] .fc-tabs__primary-group .fc-tabs__item {
    flex: 1 1 0 !important;   /* 三项等分一行 */
    text-align: center;
  }
}

/* 6) 右侧主页签：横向滑动切换（Scroll Snap） */
#right-panel-container {
  overflow-x: auto;
  overflow-y: hidden;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-x: contain;
  overscroll-behavior-y: auto;
  scrollbar-width: none;
  touch-action: pan-x pan-y;
}
#right-panel-container::-webkit-scrollbar { display: none; }

#right-panel-wrapper {
  display: flex;
  width: auto;         /* 避免固定 200%，支持任意数量页签 */
  min-width: 100%;
  height: 100%;
}

#right-panel-wrapper .fc-tab-pane {
  flex: 0 0 100%;
  width: 100%;
  scroll-snap-align: start;
  scroll-snap-stop: always;
}

/* ===== 查询榜展开 UI 与子行样式（保留展开按钮样式） ===== */
.fc-row-expander {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px; height: 22px;
  border-radius: 4px;
  border: 1px solid var(--border-color);
  background: var(--bg-secondary);
  color: var(--text-secondary);
  margin-right: 6px;
  transition: background .15s ease, color .15s ease, border-color .15s ease;
}
.fc-row-expander:hover { background: var(--bg-tertiary); color: var(--text-primary); }
.fc-row-expander i { transition: transform .18s ease; }
.fc-row-expander.is-open i,
.fc-row-expander[aria-expanded="true"] i { transform: rotate(90deg); }

/* 子行公共变量 */
:root {
  --subrow-h: 26px;
  /* 旧结构回退用的视觉缩进（兜底） */
  --subrow-indent: clamp(240px, 32vw, 480px);
}

/* 子行基础：固定行高由 .fc-subrow__row 控制 */
.fc-subrow {
  position: relative;     /* 参与堆叠 */
  z-index: 1;             /* 子行在下层 */
}
.fc-subrow td {
  background: none;
  padding: 0;             /* 统一移除 padding，内部容器自控 */
}
.fc-subrow .fc-subrow__row {
  height: var(--subrow-h);
  display: flex; align-items: center; gap: 8px;
  padding: 0; box-sizing: border-box;
}

/* 使用 colspan=6 的单元格作为锚点容器 */
.fc-subrow td[colspan] .fc-subrow__row {
  position: relative;
  padding: 0; /* 关键：去掉这里的左 padding，避免与 anchor 重复偏移 */
}
/* 锚点：优先使用运行时测得的 --subrow-anchor-x，失败则退回 --subrow-indent */
.fc-subrow td[colspan] .fc-subrow__indent {
  position: absolute;
  left: var(--subrow-anchor-x, var(--subrow-indent));
  top: 0;
  bottom: 0;
  display: inline-flex;
  align-items: center;
  /* 不需要 gap，由小圆点改为绝对定位 */
  gap: 0;
}

/* 风阻文案：仍然贴在锚点左侧，右对齐，超长向左延展 */
.fc-subrow td[colspan] .fc-subrow__extra-left {
  position: absolute;
  right: 100%;
  margin-right: 8px;
  color: var(--text-secondary);
  font-size: 14px;
  line-height: 1;
  opacity: .85;
  white-space: nowrap;
  pointer-events: none;
}

/* 小圆点放到锚点左侧，不参与排版，避免把工况文字右推 */
.fc-subrow td[colspan] .fc-subrow__dot {
  position: absolute;
  left: -14px;            /* 6px 点 + 8px 间距 */
  top: 50%;
  transform: translateY(-50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: var(--text-secondary);
  opacity: .6;
  box-shadow: 0 0 0 0.5px rgba(0,0,0,.12);
}

/* 倒数第二列（查询次数）左对齐，并补齐与父行相同的左内边距（JS 注入） */
.fc-subrow td:nth-last-child(2) { text-align: left; }
.fc-subrow td:nth-last-child(2) .fc-subrow__row {
  justify-content: flex-start;
  padding-left: var(--subrow-count-pl, .75rem);
}
/* 最后一列（操作列）居中 */
.fc-subrow td:last-child .fc-subrow__row { justify-content: center; }

/* 父行小过渡通用类：不指定初始 transform/opacity，由 JS 控制 */
.fc-fade-slide {
  transition: transform .2s ease, opacity .2s ease;
  will-change: transform, opacity;
}

/* 动画中的“下方条目”抬高层级并用表格背景遮盖子行 */
.fc-row-animating {
  position: relative;
  z-index: 3;

  /* 顶层：容器半透明层（需用 image 层保证在最上） */
  /* 中层：网页渐变（视口尺寸 + 运行时坐标对齐“对应那一块”） */
  background-image:
    linear-gradient(var(--bg-secondary), var(--bg-secondary)),
    var(--dark-rand-gradient);
  background-repeat: no-repeat, no-repeat;
  background-size: 100% 100%, 100vw 100vh;
  background-position:
    0 0,
    calc(var(--row-vp-left, 0px) * -1) calc(var(--row-vp-top, 0px) * -1);

  /* 关闭毛玻璃以防透色；可保留，也可去掉 isolation（看你实际是否需要） */
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  isolation: isolate;
}

/* 行内容在遮罩之上正常显示 */
.fc-row-animating > td,
.fc-row-animating > th {
  position: relative;
  z-index: 1;
}

/* 新增：列裁切工具类，供“接力式”位移动画期间使用 */
.fc-col-clip { overflow: hidden !important; }


/* ADD: Collapse 遮罩，背景结构与 .fc-row-animating 保持一致（双层：容器底色 + 深色随机渐变） */
.fc-collapse-mask {
  /* 顶层：容器本底色（保证覆盖子行本体） */
  /* 底层：深色随机渐变（随视口对齐，与行动画保持一致） */
  background-image:
    linear-gradient(var(--bg-secondary), var(--bg-secondary)),
    var(--dark-rand-gradient);
  background-repeat: no-repeat, no-repeat;
  background-size: 100% 100%, 100vw 100vh;
  background-position:
    0 0,
    calc(var(--row-vp-left, 0px) * -1) calc(var(--row-vp-top, 0px) * -1);

  pointer-events: none; /* 避免拦截交互 */
}