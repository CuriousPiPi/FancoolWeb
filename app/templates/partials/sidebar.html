<!-- Sidebar -->
<aside id="sidebar" class="collapsed">
  <div id="sidebar-resizer"></div>
  <div id="sidebar-header">
    <h1 class="text-xl font-bold text-center">数据管理</h1>
  </div>

  <!-- 上半区 -->
  <div id="top-panel" class="sidebar-panel">
    <div class="sidebar-panel-content">
      <nav class="tab-nav" data-tab-group="sidebar-top">
        <div class="tab-nav-item active" data-tab="recent-removed" role="tab" aria-selected="true" tabindex="0">最近移除</div>
        <div class="tab-nav-item" data-tab="recent-liked" role="tab" aria-selected="false" tabindex="-1">最近点赞</div>
      </nav>

      <div class="tab-content-container" id="sidebar-top-container">
        <div class="tab-content-wrapper" id="top-tabs-wrapper" aria-live="polite">
          <!-- 最近移除 -->
          <div class="tab-pane" id="recent-removed-pane" role="tabpanel">
            <div id="recentlyRemovedList" class="space-y-2">
              {% if session.recently_removed_fans and session.recently_removed_fans|length > 0 %}
                {% set recently_removed_list = session.recently_removed_fans.items()|list %}
                {% set recently_removed_sorted = recently_removed_list|sort(attribute='1.removed_time', reverse=true) %}
                {% for key, fan_data in recently_removed_sorted %}
                <div class="fan-item flex items-center justify-between p-3 border border-gray-200 rounded-md" data-fan-key="{{ key }}">
                  <div class="truncate">
                    <span class="font-medium">{{ fan_data.info.brand }} {{ fan_data.info.model }}</span> - 
                    <span class="text-gray-600 text-sm">
                      {% if fan_data.info.res_loc %}
                        {{ fan_data.info.res_type }}({{ fan_data.info.res_loc }})
                      {% else %}
                        {{ fan_data.info.res_type }}
                      {% endif %}
                    </span>
                  </div>
                  <button class="restore-icon text-lg" data-fan-key="{{ key }}" 
                          title="恢复至图表" aria-label="恢复到图表">
                    <i class="fa-solid fa-rotate-left"></i>
                  </button>
                </div>
                {% endfor %}
              {% else %}
                <p class="text-gray-500 text-center py-6 empty-removed">暂无最近移除的风扇</p>
              {% endif %}
            </div>
          </div>
          
          <!-- 最近点赞 -->
          <div class="tab-pane" id="recent-liked-pane" role="tabpanel">
            <div id="recentLikesList" class="space-y-2">
              <p class="text-gray-500 text-center py-6">首次打开该页签时加载...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="sidebar-splitter">
    <svg class="splitter-rails" width="100%" height="12px" viewBox="0 0 100 12" preserveAspectRatio="none" aria-hidden="true">
      <line id="sr-top-left" x1="0" y1="0.5" x2="0" y2="0.5" stroke="var(--border-color)" stroke-width="1" vector-effect="non-scaling-stroke"></line>
      <line id="sr-top-right" x1="0" y1="0.5" x2="0" y2="0.5" stroke="var(--border-color)" stroke-width="1" vector-effect="non-scaling-stroke"></line>
      <line id="sr-bot-left" x1="0" y1="11.5" x2="0" y2="11.5" stroke="var(--border-color)" stroke-width="1" vector-effect="non-scaling-stroke"></line>
      <line id="sr-bot-right" x1="0" y1="11.5" x2="0" y2="11.5" stroke="var(--border-color)" stroke-width="1" vector-effect="non-scaling-stroke"></line>
    </svg>
  
    <button id="sidebar-splitter-handle"
            class="splitter-handle"
            type="button"
            role="separator"
            aria-orientation="horizontal"
            aria-label="拖拽调整上下面板高度"></button>
  </div>

  <!-- 下半区 -->
  <div id="bottom-panel" class="sidebar-panel">
    <div class="sidebar-panel-content">
      <h2 class="text-lg font-semibold mb-3">已添加的数据 (<span id="selectedCount">{{ selected_fans|length }}</span>/{{ max_chart_items }})</h2>
      <div id="selectedFansList" class="space-y-2">
        {% for fan in selected_fans %}
        <div class="fan-item flex items-center justify-between p-3 border border-gray-200 rounded-md"
             data-fan-key="{{ fan.key }}"
             data-map="{{ fan.brand }}||{{ fan.model }}||{{ fan.res_type }}||{{ fan.res_loc or '无' }}">
          <div class="flex items-center min-w-0">
            <div class="w-3 h-3 rounded-full mr-2 flex-shrink-0 js-color-dot"></div>
            <div class="truncate">
              <span class="font-medium">{{ fan.brand }} {{ fan.model }}</span> - 
              <span class="text-gray-600 text-sm">
                {% if fan.res_loc %}
                  {{ fan.res_type }}({{ fan.res_loc }})
                {% else %}
                  {{ fan.res_type }}
                {% endif %}
              </span>
            </div>
          </div>
          <div class="flex items-center flex-shrink-0">
            <button class="like-button mr-3"
                    data-fan-key="{{ fan.key }}"
                    data-model-id="{{ fan.model_id }}"
                    data-condition-id="{{ fan.condition_id }}"
                    aria-label="点赞">
              <i class="fa-solid fa-thumbs-up text-gray-400"></i>
            </button>
            <button class="btn-add" data-mode="remove" data-fan-key="{{ fan.key }}" 
                    title="移除" aria-label="移除">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="sticky-footer text-center {% if not selected_fans %}hidden{% endif %}" id="clearAllContainer">
      <button id="clearAllBtn" class="w-full ui-btn secondary" style="font-size: 16px;" 
              aria-label="移除所有已选择的风扇">
        移除所有
      </button>
    </div>
  </div>
</aside>