{% extends 'base.html' %}
{% block title %}风扇库{% endblock %}
{% block content %}
<!-- ============ 页面主体（原 fancoolindex.html DOM 全量迁移占位：后续分阶段精简） ============ -->
<div id="app-root">
  <!-- 原始结构开始：保留原 id/class 以保证现有脚本在迁移前仍可工作 -->
  <!-- 由于首阶段仅完成模板/样式抽离，这里临时内联载入原主体 HTML（样式已移至 app.css）。
       下一阶段：
       1. 分离 sidebar 上/下部分为独立块（可选）
       2. 重构事件绑定到 events.js
       3. 拆分长表格/列表渲染逻辑进入 render.js
  -->
  <div data-original-fragment="sidebar-and-main">
    <!-- 请注意：为避免一次性提交 4000+ 行难以 Review，这里暂留占位。
         后续增量提交会把剩余 DOM 逐段搬运并清理。 -->
    <p class="text-sm text-muted p-4">正在进行样式与结构重构：其余 DOM 将在下一次提交中完整迁移。此占位用于保持页面可访问性。</p>
  </div>

  <!-- 示例：排行榜表格（用于验证抽离样式 & 渐变遮罩效果） -->
  <section class="p-4">
    <h2 class="font-semibold mb-3">排行榜示例</h2>
    <div class="rank-content-box u-edge-mask-right overflow-auto max-h-72 border border-divider rounded-lg">
      <table class="ranking-table w-full">
        <thead>
          <tr>
            <th class="sticky top-0 bg-surface">#</th>
            <th class="sticky top-0 bg-surface">名称(跑马灯保留)</th>
            <th class="sticky top-0 bg-surface">噪声</th>
            <th class="sticky top-0 bg-surface">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for i in range(1,26) %}
          <tr>
            <td class="text-center">{{ i }}</td>
            <td class="marquee-cell"><span class="marquee-inner">示例风扇型号名称特别特别长需要滚动显示 {{ i }}</span></td>
            <td>{{ 40 + i }} dB</td>
            <td><button class="ui-btn ui-btn-xs">添加</button></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <p class="mt-2 text-xs text-muted">右缘使用渐变遮罩（.u-edge-mask-right），跑马灯逻辑 hover 时触发平滑横移。</p>
  </section>
</div>
<div id="toastContainer" class="toast-container"></div>
{% endblock %}
{% block extra_scripts %}
<script>
// 跑马灯 hover 逻辑：保留旧体验，后续会迁移到 ui_components.js
(function(){
  function activate(cell){
    const inner = cell.querySelector('.marquee-inner');
    if(!inner) return;
    const overflow = inner.scrollWidth - cell.clientWidth;
    if(overflow>0){
      inner.style.transition = 'transform '+ Math.min(12, overflow/30) +'s linear';
      inner.style.transform = 'translateX('+ (-overflow) +'px)';
    }
  }
  function reset(cell){
    const inner = cell.querySelector('.marquee-inner');
    if(!inner) return;
    inner.style.transition = 'transform .4s ease';
    inner.style.transform = 'translateX(0)';
  }
  document.addEventListener('pointerenter', e => {
    const c = e.target.closest('.marquee-cell');
    if(c) activate(c);
  }, true);
  document.addEventListener('pointerleave', e => {
    const c = e.target.closest('.marquee-cell');
    if(c) reset(c);
  }, true);
})();
</script>
{% endblock %}