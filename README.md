文件	职责	主要内容（从原文件迁移）	对外暴露（window.__APP 下挂载）
js/core.js	基础工具/缓存/调度/公共函数	dom 缓存(one/all/clear)、scheduler、通用缓存cache、HTML 转义、toast & loading、throttle、safeClosest、formatScenario、logger（简单）	__APP.dom / __APP.scheduler / __APP.cache / __APP.util
js/color.js	颜色 & 主题 & 颜色索引持久化	palette、currentThemeStr、darkToLightLinear、colorIndexMap 及 ensureColorIndexForKey / releaseColorIndexForKey（按“简化规则”但本轮先原样搬）、withFrontColors、applySidebarColors（暂保留）	__APP.color （包含：getColorForKey, ensureIndex, load/saveMap, currentPalette 等）
js/chart.js	图表通信 & X 轴类型 & 过滤	chartFrame 监听、postChartData、filterChartDataForAxis、resizeChart、frontXAxisType 持久化逻辑、getChartBg、分享 meta 处理（pendingShareMeta）	__APP.chart（postChartData, resizeChart, setAxisType, getAxisType）
js/layout.js	侧栏 / Overlay / 手势 / Splitter / Resizer / Tabs / Marquee / Tooltip / 焦点陷阱 / 自适应高度	overlayOpen/Close/Toggle、gesture zone、splitter（上下）、resizer（左右）、tab 激活 logic、marquee 三类、tooltip、focusTrap、adjustBottomPanelAuto、scheduleAdjust、sidebar toggle 各种逻辑	__APP.layout（toggleSidebar, scheduleAdjust, applyMarquees...） / __APP.a11y（focusTrap 等）
js/state-ui.js	选中列表 / 最近移除 / 最近点赞 / 排行榜 / 搜索 / 点赞操作 / 表单级联	rebuildSelectedFans、rebuildRemovedFans、rebuildRecentLikes、reloadRecentLikes、searchForm 相关、ranking（好评榜）、add/remove/restore/clear all、like/unlike、级联选择联动	__APP.stateUI（各种 rebuild / load / action 函数）
js/main.js	入口整合 & 初始数据拉取 & wiring	初始化 window.__APP 根、导入上述模块（若不用 ES module 则通过 script 顺序加载）、调用初始 fetch('/api/state')、绑定主题按钮、加载 query count、分享自动滚动、监听 postMessage（chart:ready / chart:xaxis-type-changed）	（作为入口不再额外挂）
js/fancool.js (兼容层)	旧入口（保留）	仅负责按顺序加载上述脚本（或 import），然后暴露与原来相同的 window.__APP.modules	同名旧接口转发
